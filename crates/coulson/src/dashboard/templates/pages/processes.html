{% extends "base.html" %}
{% block content %}
<div class="flex items-start justify-between mb-8">
  <div>
    <h1 class="text-2xl font-semibold tracking-tight">Processes</h1>
    <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">Managed app processes (ASGI, etc.)</p>
  </div>
</div>

{% if processes | length == 0 %}
<div class="rounded-xl border border-zinc-200 bg-white p-12 text-center shadow-sm dark:border-zinc-800 dark:bg-zinc-900">
  <svg class="mx-auto h-10 w-10 text-zinc-300 dark:text-zinc-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 01-3-3m3 3a3 3 0 100 6h13.5a3 3 0 100-6m-16.5-3a3 3 0 013-3h13.5a3 3 0 013 3m-19.5 0a4.5 4.5 0 01.9-2.7L5.737 5.1a3.375 3.375 0 012.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 01.9 2.7m0 0a3 3 0 01-3 3m0 3h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008zm-3 6h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008z"/></svg>
  <p class="mt-3 text-sm font-medium text-zinc-500 dark:text-zinc-400">No managed processes running</p>
  <p class="mt-1 text-xs text-zinc-400 dark:text-zinc-500">Managed apps (ASGI) start automatically on first request.</p>
</div>
{% else %}
<div class="rounded-xl border border-zinc-200 bg-white shadow-sm dark:border-zinc-800 dark:bg-zinc-900 overflow-hidden">
  <table class="w-full text-sm">
    <thead>
      <tr class="border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-800/50">
        <th class="px-4 py-2.5 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider">App</th>
        <th class="px-4 py-2.5 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider">PID</th>
        <th class="px-4 py-2.5 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider">Kind</th>
        <th class="px-4 py-2.5 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider">Uptime</th>
        <th class="px-4 py-2.5 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider">Idle</th>
        <th class="px-4 py-2.5 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider">Status</th>
        <th class="px-4 py-2.5 text-right text-xs font-medium text-zinc-500 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-zinc-100 dark:divide-zinc-800">
{% for proc in processes %}
      <tr class="hover:bg-zinc-50 dark:hover:bg-zinc-800/50">
        <td class="px-4 py-2.5">
          {% if proc.app_name %}<a href="/apps/{{ proc.app_name }}" class="text-sm font-medium text-zinc-900 dark:text-zinc-100 hover:underline">{{ proc.app_name }}</a>{% else %}<span class="text-sm text-zinc-500">app#{{ proc.app_id }}</span>{% endif %}
        </td>
        <td class="px-4 py-2.5 font-mono text-xs text-zinc-500 dark:text-zinc-400">{{ proc.pid }}</td>
        <td class="px-4 py-2.5"><span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium bg-blue-50 text-blue-700 ring-1 ring-inset ring-blue-700/10 dark:bg-blue-900/30 dark:text-blue-400">{{ proc.kind }}</span></td>
        <td class="px-4 py-2.5 text-sm text-zinc-600 dark:text-zinc-400">{{ proc.uptime_display }}</td>
        <td class="px-4 py-2.5 text-sm text-zinc-600 dark:text-zinc-400">{{ proc.idle_display }}</td>
        <td class="px-4 py-2.5">
          {% if proc.alive %}
          <span class="inline-flex items-center gap-1.5 text-xs font-medium text-emerald-700 dark:text-emerald-400"><span class="h-1.5 w-1.5 rounded-full bg-emerald-500"></span>Running</span>
          {% else %}
          <span class="inline-flex items-center gap-1.5 text-xs font-medium text-red-700 dark:text-red-400"><span class="h-1.5 w-1.5 rounded-full bg-red-500"></span>Exited</span>
          {% endif %}
        </td>
        <td class="px-4 py-2.5 text-right">
          <div class="flex items-center justify-end gap-2">
            <form method="post" action="/processes/{{ proc.app_id }}/restart">
              <button type="submit" class="inline-flex items-center gap-1 rounded-md bg-zinc-100 px-2 py-1 text-xs font-medium text-zinc-700 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700 transition-colors">
                <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182M2.985 19.644l3.181-3.182"/></svg>
                Restart
              </button>
            </form>
            {% if proc.app_name %}
            <a href="/processes/{{ proc.app_id }}/log" class="inline-flex items-center gap-1 rounded-md bg-zinc-100 px-2 py-1 text-xs font-medium text-zinc-700 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700 transition-colors">
              <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg>
              Log
            </a>
            {% endif %}
          </div>
        </td>
      </tr>
{% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock content %}
